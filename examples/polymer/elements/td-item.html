<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="td-input.html">

<dom-module id="td-item">
	<template>
		<link rel="stylesheet" href="td-item.css">
		<template is="dom-if" if="{{!editing}}">
			<div class$="{{itemClass}}" on-dblclick="editAction">
				<input type="checkbox" class="toggle" checked$="{{item.completed}}" on-click="itemChangeAction">
				<label>{{item.title}}</label>
				<button class="destroy" on-click="destroyAction"></button>
			</div>
		</template>
		<template is="dom-if" if="{{editing}}">
			<input is="td-input" id="edit" class="edit" value="{{item.title}}" on-td-input-commit="commitAction" on-td-input-cancel="cancelAction">
		</template>
	</template>
	<script>
		(function() {
			Polymer({
				is: 'td-item',
				extends: 'li',
				listeners: {
					'blur': 'commitAction'
				},
				properties: {
					editing: {
						type: Boolean,
						value: false
					},
					item: {
						type: Object,
						value: function() {
							return {};
						}
					},
					itemClass: {
						type: String,
						computed: 'getItemClass(item.completed, editing)'
					}
				},
				getItemClass: function(completed, editing) {
					var ret = 'view ';

					ret += completed ? 'completed ' : '';
					ret += editing ? 'editing' : '';

					return ret;
				},
				editAction: function() {
					this.editing = true;
				},
				commitAction: function() {
					if (this.editing) {
						this.editing = false;
						this.item.title = this.item.title.trim();
						if (this.item.title === '') {
							this.destroyAction();
						}
						this.fire('td-item-changed');
					}
				},
				cancelAction: function() {
					this.editing = false;
				},
				itemChangeAction: function() {
					this.fire('td-item-changed');
				},
				destroyAction: function() {
					this.fire('td-destroy-item', this.item);
				}
			});
		})();
	</script>
</dom-module>
